$.fn.popup=function(p,t){var i={backdrop:!0,click:!0,keyboard:!0},o=$.extend({},i,t);return"toggle"==p?(this.popup(this.is(":visible")?"hide":"show",t),this):(this.data({popupSettings:o}),this.find(".popup-backdrop").filter(function(){return!$(this).data("popupInit")}).data({popupInit:1}).click(function(){$(this).parent().data("popupSettings").click&&$(this).parent().popup("hide")}),"hide"==p?(this.find(".popup-container").animate({top:0-1.5*this.find(".popup-container").height()}),this.find(".popup-backdrop").fadeOut(500,function(){$(this).parent().hide()})):"show"!=p&&p||(this.find(".popup-backdrop,.popup-container").hide(),this.show(),this.find(".popup-container").css({top:0-1.5*this.find(".popup-container").height()}).show().animate({top:"50%"}),this.data("popupSettings").backdrop?this.find(".popup-backdrop").fadeIn(500):this.find(".popup-backdrop").css({opacity:0}).show()),this)},$(document).keyup(function(p){27==p.keyCode&&$(".popup:visible").length&&$(".popup:visible").filter(function(){return $(this).data("popupSettings").keyboard}).popup("hide")}),$("#test-popup").popup("show");